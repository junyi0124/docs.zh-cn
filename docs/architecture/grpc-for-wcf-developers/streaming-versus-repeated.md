---
title: 流服务与重复字段 - gRPC 面向 WCF 开发人员
description: 将重复字段与流服务进行比较，作为使用 gRPC 传递数据集合的方法。
ms.date: 09/02/2019
ms.openlocfilehash: 542ebc393f9c9c1ad717d02d01fab33d85c18917
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/12/2020
ms.locfileid: "79147745"
---
# <a name="grpc-streaming-services-vs-repeated-fields"></a>gRPC 流式处理服务与重复字段

gRPC 服务提供两种返回数据集或对象列表的方法。 协议缓冲区消息规范使用 关键字`repeated`声明另一消息中的消息列表或数组。 gRPC 服务规范使用`stream`关键字声明长时间运行的持久连接。 通过该连接，将发送多条消息，并可以单独处理。

您还可以使用该`stream`功能对长时间运行的时间数据（如通知或日志消息）使用。 但本章将考虑用于返回单个数据集。

您应该使用哪些取决于如下因素：

- 数据集的总体大小。
- 在客户端或服务器端创建数据集所花的时间。
- 数据集的使用者是否可以在第一个项目可用时立即开始对它进行操作，或者需要完整的数据集执行任何有用的操作。

## <a name="when-to-use-repeated-fields"></a>何时使用`repeated`字段

对于大小受限且可以在短时间内生成完整数据集的任何数据集（例如，在一秒以下），应在常规 Protobuf 消息中使用`repeated`字段。 例如，在电子商务系统中，在订单中生成项目列表可能很快，并且列表不会很大。 使用`repeated`字段返回单个消息比使用`stream`快一个数量级，并且产生的网络开销更少。

如果客户端在开始处理之前需要所有数据，并且数据集足够小，足以在内存中构造，则请考虑使用字段`repeated`。 即使服务器上的内存中数据集的创建速度较慢，也请考虑它。

## <a name="when-to-use-stream-methods"></a>何时使用`stream`方法

当数据集中的消息对象可能非常大时，最好使用流式处理请求或响应来传输它们。 在内存中构造大型对象、将其写入网络，然后释放资源会更有效。 此方法将提高服务的可扩展性。

同样，您应该在流上发送无约束大小的数据集，以避免在构造时内存不足。

对于使用者可以单独处理每个项目的数据集，如果意味着可以向用户指示进度，则应考虑使用流。 使用流可以提高应用程序的响应能力，但应平衡它与应用程序的整体性能。

流可能有用的另一个方案是跨多个服务处理消息。 如果链中的每个服务返回一个流，则终端服务（即链中的最后一个服务）可以开始返回消息。 这些消息可以处理，并沿链传回原始请求者。 请求者可以返回流或将结果聚合到单个响应消息中。 此方法非常适合像 MapReduce 这样的模式。

>[!div class="step-by-step"]
>[上一个](migrate-duplex-services.md)
>[下一个](client-libraries.md)
