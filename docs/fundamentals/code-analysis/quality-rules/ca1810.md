---
title: 'CA1810：以内联方式初始化引用类型静态字段 (代码分析) '
description: 了解代码分析规则 CA1810：以内联方式初始化引用类型的静态字段
ms.date: 11/04/2016
ms.topic: reference
f1_keywords:
- InitializeReferenceTypeStaticFieldsInline
- CA1810
helpviewer_keywords:
- InitializeReferenceTypeStaticFieldsInline
- CA1810
author: gewarren
ms.author: gewarren
dev_langs:
- CSharp
- VB
ms.openlocfilehash: 4e9d9c640db652627dd799574516a6b8e3ee0954
ms.sourcegitcommit: a6bd4cad438fe479cbd112eae10f2cd449f06e40
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 10/08/2020
ms.locfileid: "96590879"
---
# <a name="ca1810-initialize-reference-type-static-fields-inline"></a>CA1810:以内联方式初始化引用类型的静态字段

| | 值 |
|-|-|
| **规则 ID** |CA1810|
| **类别** |Microsoft. 性能|
| **修复是中断或非中断** |不间断|

## <a name="cause"></a>原因

引用类型声明显式静态构造函数。

## <a name="rule-description"></a>规则说明

当一个类型声明显式静态构造函数时，实时 (JIT) 编译器会向该类型的每个静态方法和实例构造函数中添加一项检查，以确保之前已调用该静态构造函数。 当访问任何静态成员或创建类型的实例时，将触发静态初始化。 但是，如果您声明一个类型的变量，但不使用它，则不会触发静态初始化，如果初始化更改全局状态，这可能很重要。

当所有静态数据都以内联方式初始化并且未声明显式静态构造函数时，Microsoft 中间语言 (MSIL) 编译器将 `beforefieldinit` 标志和隐式静态构造函数（该构造函数初始化静态数据）添加到 MSIL 类型定义。 当 JIT 编译器遇到标志时 `beforefieldinit` ，大多数情况下不会添加静态构造函数检查。 在访问静态方法之前，但在调用静态方法或实例构造函数之前，不能保证静态初始化在访问任何静态字段之前发生。 请注意，在声明类型的变量后，可能会随时发生静态初始化。

静态构造函数检查会降低性能。 通常，静态构造函数仅用于初始化静态字段，在这种情况下，必须仅确保在首次访问静态字段之前发生静态初始化。 此 `beforefieldinit` 行为适用于这些类型和大多数其他类型。 仅当静态初始化影响全局状态并且满足以下任一条件时，它才是不适当的：

- 全局状态的影响非常昂贵，如果未使用该类型，则不需要这样做。

- 可以在不访问类型的任何静态字段的情况下访问全局状态效果。

## <a name="how-to-fix-violations"></a>如何解决冲突

要修复与该规则的冲突，请在声明它时初始化所有静态数据并移除静态构造函数。

## <a name="when-to-suppress-warnings"></a>何时禁止显示警告

如果性能不是问题，则可以安全地禁止显示此规则发出的警告;或者，如果静态初始化导致的全局状态更改很昂贵，或者必须保证在调用类型的静态方法或创建类型的实例之前发生。

## <a name="example"></a>示例

下面的示例演示了一个类型， `StaticConstructor` 该类型违反了规则和一个类型， `NoStaticConstructor` 该类型使用内联初始化替换静态构造函数来满足规则。

:::code language="csharp" source="snippets/csharp/all-rules/ca1810.cs" id="snippet1":::

:::code language="vb" source="snippets/vb/all-rules/ca1810-initialize-reference-type-static-fields-inline_1.vb":::

请注意，在 `beforefieldinit` 类的 MSIL 定义上添加标志 `NoStaticConstructor` 。

```il
.class public auto ansi StaticConstructor
extends [mscorlib]System.Object
{
} // end of class StaticConstructor

.class public auto ansi beforefieldinit NoStaticConstructor
extends [mscorlib]System.Object
{
} // end of class NoStaticConstructor
```

## <a name="related-rules"></a>相关规则

- [CA2207:以内联方式初始化值类型的静态字段](ca2207.md)
